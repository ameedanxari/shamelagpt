{"openapi":"3.1.0","info":{"title":"Shamela RAG API","version":"0.1.0"},"paths":{"/api/auth/signup":{"post":{"tags":["auth"],"summary":"Signup","description":"Sign up endpoint - Backend handles everything.\n\nFrontend sends: email, password, display_name\nBackend:\n1. Creates user in Firebase\n2. Gets Firebase ID token\n3. Creates user in our database\n4. Returns token + user info\n\nNo Authorization header needed!","operationId":"signup_api_auth_signup_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SignupRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/login":{"post":{"tags":["auth"],"summary":"Login","description":"Login endpoint - Backend handles everything.\n\nFrontend sends: email, password\nBackend:\n1. Authenticates with Firebase\n2. Gets Firebase ID token\n3. Gets/creates user in our database\n4. Returns token + user info\n\nNo Authorization header needed!","operationId":"login_api_auth_login_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/me":{"get":{"tags":["auth"],"summary":"Get Current User Info","description":"Get current authenticated user's information.\nRequires valid Firebase authentication token.","operationId":"get_current_user_info_api_auth_me_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}}},"security":[{"HTTPBearer":[]}]},"put":{"tags":["auth"],"summary":"Update Current User","description":"Update current authenticated user's information.\nRequires valid Firebase authentication token.\n\nIMPORTANT: This only updates the user's info in our database, NOT in Firebase.\n- Updating email in Firebase requires reauthentication and should be done client-side\n- display_name can be safely updated here\n- For email changes: User must update email in Firebase first (client-side), then update here","operationId":"update_current_user_api_auth_me_put","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateUserRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]},"delete":{"tags":["auth"],"summary":"Delete Current User","description":"Delete current authenticated user's account.\nRequires valid Firebase authentication token.\n\nNote: This only deletes the user from our database.\nThe Firebase account should be deleted separately.","operationId":"delete_current_user_api_auth_me_delete","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]}},"/api/auth/verify":{"get":{"tags":["auth"],"summary":"Verify Token","description":"Verify that the provided Firebase token is valid.\nUseful for checking authentication status.","operationId":"verify_token_api_auth_verify_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]}},"/api/auth/me/preferences":{"get":{"tags":["auth"],"summary":"Get User Preferences","description":"Get current user's preferences (language, custom prompt, response style).","operationId":"get_user_preferences_api_auth_me_preferences_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]},"put":{"tags":["auth"],"summary":"Set User Preferences","description":"Update user's preferences (language, custom prompt, response style).\n\n- language_preference: \"auto\", \"Arabic\", \"English\", etc.\n- custom_system_prompt: Additional modifier appended to the default system prompt.\n- response_preferences: Dict with {length, style, focus}","operationId":"set_user_preferences_api_auth_me_preferences_put","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserPreferencesRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/guest/chat/stream":{"post":{"tags":["guest-chat"],"summary":"Guest Chat Stream","description":"PUBLIC guest chat endpoint - NO authentication required.\n\nFeatures:\n- No signup/login required\n- Rate limited per IP address (10 requests per minute)\n- Session-based conversation tracking (client-side)\n- No database storage\n- Real-time token streaming\n- Optional chain-of-thought thinking\n\nRate Limits:\n- 10 requests per minute per IP address\n- Returns 429 Too Many Requests if exceeded\n\nReturns: text/event-stream with chunks as they generate","operationId":"guest_chat_stream_api_guest_chat_stream_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GuestChatRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/guest/health":{"get":{"tags":["guest-chat"],"summary":"Guest Health","description":"Public health check for guest endpoints.","operationId":"guest_health_api_guest_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/health":{"get":{"tags":["chat"],"summary":"Health","description":"Public health check endpoint - no authentication required.","operationId":"health_api_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/chat":{"post":{"tags":["chat"],"summary":"Chat","description":"Protected chat endpoint - requires Firebase authentication.\n\nFeatures:\n- Language preference hierarchy: request > conversation > user > auto-detect\n- Custom system prompts (modifiers, not replacements)\n- Auto-generated AI conversation titles for new threads\n\nHeaders required:\n- Authorization: Bearer <firebase_id_token>","operationId":"chat_api_chat_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/chat/stream":{"post":{"tags":["chat"],"summary":"Chat Stream","description":"Protected STREAMING chat endpoint - returns Server-Sent Events (SSE).\n\nFeatures:\n- Real-time token streaming\n- Cancellation support (client disconnect detection)\n- Language preference hierarchy: request > conversation > user > auto-detect\n- Custom system prompts (modifiers, not replacements)\n- Auto-generated AI conversation titles for new threads\n\nHeaders required:\n- Authorization: Bearer <firebase_id_token>\n\nReturns: text/event-stream with chunks as they generate","operationId":"chat_stream_api_chat_stream_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/chat/generate-title":{"post":{"tags":["chat"],"summary":"Generate Conversation Title","description":"Generate an AI-powered title for a conversation based on the first question.\n\nRequest Body:\n- question: str (required) - The first question in the conversation\n- language: str (optional) - Language for the title (\"Arabic\" or \"English\", default: \"Arabic\")\n\nReturns:\n- title: str - AI-generated concise title","operationId":"generate_conversation_title_api_chat_generate_title_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GenerateTitleRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/conversations":{"get":{"tags":["conversations"],"summary":"Get Conversations","description":"List all conversations for authenticated user. Protected endpoint.\n\nHeaders required:\n- Authorization: Bearer <firebase_id_token>","operationId":"get_conversations_api_conversations_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]},"post":{"tags":["conversations"],"summary":"New Conversation","description":"Create a new conversation. Protected endpoint.\n\nHeaders required:\n- Authorization: Bearer <firebase_id_token>","operationId":"new_conversation_api_conversations_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConversationRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]},"delete":{"tags":["conversations"],"summary":"Remove All Conversations","description":"Delete all conversations for authenticated user. Protected endpoint.\n\nHeaders required:\n- Authorization: Bearer <firebase_id_token>","operationId":"remove_all_conversations_api_conversations_delete","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]}},"/api/conversations/{conversation_id}/messages":{"get":{"tags":["conversations"],"summary":"Get Conversation Messages","description":"Return all messages for a conversation. Protected endpoint.\nOnly the conversation owner can access it.\n\nHeaders required:\n- Authorization: Bearer <firebase_id_token>","operationId":"get_conversation_messages_api_conversations__conversation_id__messages_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"conversation_id","in":"path","required":true,"schema":{"type":"string","title":"Conversation Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/conversations/{conversation_id}":{"delete":{"tags":["conversations"],"summary":"Remove Conversation","description":"Delete a specific conversation. Protected endpoint.\nOnly the conversation owner can delete it.\n\nHeaders required:\n- Authorization: Bearer <firebase_id_token>","operationId":"remove_conversation_api_conversations__conversation_id__delete","security":[{"HTTPBearer":[]}],"parameters":[{"name":"conversation_id","in":"path","required":true,"schema":{"type":"string","title":"Conversation Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"AuthResponse":{"properties":{"token":{"type":"string","title":"Token"},"refresh_token":{"type":"string","title":"Refresh Token"},"expires_in":{"type":"string","title":"Expires In"},"user":{"additionalProperties":true,"type":"object","title":"User"}},"type":"object","required":["token","refresh_token","expires_in","user"],"title":"AuthResponse","description":"Response model for authentication - includes token and user data."},"ChatRequest":{"properties":{"question":{"type":"string","title":"Question"},"thread_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Thread Id"},"prompt_config":{"anyOf":[{"type":"string"},{"additionalProperties":true,"type":"object"},{},{"type":"null"}],"title":"Prompt Config","default":"Optimized"},"language_preference":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Language Preference"},"custom_system_prompt":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Custom System Prompt"},"enable_thinking":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Enable Thinking","default":true}},"type":"object","required":["question"],"title":"ChatRequest"},"ConversationRequest":{"properties":{"title":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Title","default":"New Chat"}},"type":"object","title":"ConversationRequest"},"GenerateTitleRequest":{"properties":{"question":{"type":"string","title":"Question"},"language":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Language","default":"Arabic"}},"type":"object","required":["question"],"title":"GenerateTitleRequest","description":"Request model for generating conversation title."},"GuestChatRequest":{"properties":{"question":{"type":"string","title":"Question"},"session_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Session Id"},"prompt_config":{"anyOf":[{"type":"string"},{"additionalProperties":true,"type":"object"},{},{"type":"null"}],"title":"Prompt Config","default":"Optimized"},"language_preference":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Language Preference"},"enable_thinking":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Enable Thinking","default":true}},"type":"object","required":["question"],"title":"GuestChatRequest","description":"Request model for guest chat - no authentication."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"LoginRequest":{"properties":{"email":{"type":"string","format":"email","title":"Email"},"password":{"type":"string","title":"Password"}},"type":"object","required":["email","password"],"title":"LoginRequest","description":"Request model for login - email and password required."},"ResponsePreferencesRequest":{"properties":{"length":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Length"},"style":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Style"},"focus":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Focus"}},"type":"object","title":"ResponsePreferencesRequest","description":"Response style preferences."},"SignupRequest":{"properties":{"email":{"type":"string","format":"email","title":"Email"},"password":{"type":"string","title":"Password"},"display_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Display Name"}},"type":"object","required":["email","password"],"title":"SignupRequest","description":"Request model for signup - email and password required."},"UpdateUserRequest":{"properties":{"email":{"anyOf":[{"type":"string","format":"email"},{"type":"null"}],"title":"Email"},"display_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Display Name"}},"type":"object","title":"UpdateUserRequest","description":"Request model for updating user info."},"UserPreferencesRequest":{"properties":{"language_preference":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Language Preference"},"custom_system_prompt":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Custom System Prompt"},"response_preferences":{"anyOf":[{"$ref":"#/components/schemas/ResponsePreferencesRequest"},{"type":"null"}]}},"type":"object","title":"UserPreferencesRequest","description":"Request model for updating user preferences."},"UserResponse":{"properties":{"id":{"type":"string","title":"Id"},"firebase_uid":{"type":"string","title":"Firebase Uid"},"email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Email"},"display_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Display Name"},"created_at":{"type":"string","title":"Created At"},"updated_at":{"type":"string","title":"Updated At"},"last_login":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Last Login"}},"type":"object","required":["id","firebase_uid","created_at","updated_at"],"title":"UserResponse","description":"Response model for user data."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"HTTPBearer":{"type":"http","scheme":"bearer"}}}}